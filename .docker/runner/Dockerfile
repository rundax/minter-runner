ARG DOCKER_IMAGE_VERSION=master
ARG DOCKER_SERVER_HOST
ARG DOCKER_PROJECT_PATH
ARG DOCKER_NODE_VERSION
ARG APP_ENV=prod

FROM ${DOCKER_SERVER_HOST}/${DOCKER_PROJECT_PATH}/app-prod:${DOCKER_IMAGE_VERSION} AS app
FROM ${DOCKER_SERVER_HOST}/${DOCKER_PROJECT_PATH}/node${DOCKER_NODE_VERSION}-minter:${DOCKER_IMAGE_VERSION}

RUN apk update && \
    apk upgrade && \
    apk add aria2

COPY --from=app /app/dist /app

USER minter-runner

WORKDIR /app

STOPSIGNAL SIGINT

ENV NODE_OPTIONS="--enable-source-maps"
CMD ["node", "app.js"]
